<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Dynamsoft Barcode Reader Sample - Video Decoding</title>
    <script src="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode/dist/dbr.js"></script>
</head>

<!-- 
    This sample demonstrates how to use the library to decode video stream from a USB-connected or built-in camera,
    whether on mobile or desktop. If you are looking to read barcodes directly from an existing image, 
    please refer to the "Read an Image" sample instead.

    Please note that the organizationID '200001' corresponds to Dynamsoft's public trial license which is reserved for public samples. 
    When hosting the sample in your own environment, please obtain a private trial license or a full license by contacting the 
    Dynamsoft Support Team via support@dynamsoft.com 
-->

<body>
    <button id="backToNormal" hidden>Exit</button>
    <h2>Read Video Stream</h2>
    <input type="text" id="result" title="Double click to clear!" readonly="true" class="latest-result"
        placeholder="The Last Read Barcode">
    <div id="UIElement">
        <span id='lib-load' style='font-size:x-large' hidden>Loading Library...</span>
    </div>
    <div>
        <span style="float:left">All Results:</span><br />
        <div id="results"></div>
    </div>
    <script>
        // scanner for decoding video
        let scanner = null;
        window.onload = async function () {
            //Load the library on page load to speed things up.
            try {
                Dynamsoft.DBR.BarcodeReader.organizationID = "100448235";
                document.getElementById('lib-load').hidden = false;
                await Dynamsoft.DBR.BarcodeReader.loadWasm();
                startBarcodeScanner();
            } catch (ex) {
                alert(ex.message);
                throw ex;
            }
            document.getElementById('result').addEventListener('dblclick', async () => {
                document.getElementById('result').value = "";
            });
        };
        // decode video from camera
        async function startBarcodeScanner() {
            try {
                scanner = scanner || await Dynamsoft.DBR.BarcodeScanner.createInstance();
                document.getElementById('lib-load').hidden = true;
                scanner.onFrameRead = (_results) => {
                    for (let result of _results) {
                        let newElements = [];
                        document.getElementById('result').value = result.barcodeFormatString + ": " + result.barcodeText;
                        newElements.push(createAnSpan(result.barcodeFormatString + ": "));
                        newElements.push(createAnSpan(result.barcodeText, "resultText"));
                        newElements.push(document.createElement('br'));
                        if (result.barcodeText.indexOf("Attention(exceptionCode") != -1) {
                            newElements.push(createAnSpan(" Error: " + result.exception.message));
                            newElements.push(document.createElement('br'));
                        }
                        for (let span of newElements) {
                            document.getElementById('results').appendChild(span);
                        }
                        document.getElementById('results').scrollTop = document.getElementById('results').scrollHeight;
                    }
                };
                document.getElementById('UIElement').appendChild(scanner.getUIElement());
                await scanner.show();
                document.getElementById('results').style.visibility = "visible";
            } catch (ex) {
                alert(ex.message);
                throw ex;
            }
        }
        function createAnSpan(txt, className) {
            let newSPAN = document.createElement("span");
            newSPAN.textContent = txt;
            if (className)
                newSPAN.className = className;
            return newSPAN;
        }
    </script>
</body>
<style>
    button#backToNormal {
        position: absolute;
        z-index: 10000000;
        top: 5vh;
    }

    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        width: 100vw;
        height: 90vh;
        color: #455A64;
        margin: 0;
    }

    button {
        font-size: 1.5rem;
        margin-bottom: 2vh;
    }

    span {
        font-size: 0.8rem;
    }

    .latest-result {
        display: block;
        margin: 0;
        padding: 0.4rem 0.8rem;
        color: inherit;
        width: 80vw;
        border: none;
        font-size: 1rem;
        border-radius: 0.2rem;
        text-align: center;
    }

    .latest-result::placeholder {
        color: #B0BEC5;
    }

    .latest-result:focus {
        outline: none;
        box-shadow: 0.1rem 0.4rem 0.8rem #5e35b1;
    }

    #results {
        border: 1px dashed grey;
        overflow: auto;
        width: 80vw;
        padding: 2vmin;
        margin-bottom: 3vh;
        height: 15vh;
    }

    .resultText {
        color: #cE5E04
    }

    .bigger {
        font-size: large;
        margin-bottom: 2%;
    }

    #UIElement {
        margin: 2vmin auto;
        text-align: center;
        font-size: medium;
        height: 40vh;
        width: 80vw;
    }

    #UIElement img {
        max-width: 100%;
        max-height: 90%;
        border: solid 1px gray;
    }
</style>

</html>