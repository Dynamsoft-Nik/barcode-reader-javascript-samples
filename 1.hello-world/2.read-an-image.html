<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="description" content="Read barcodes from images in no time with Dynamsoft Barcode Reader. With this online demo, you can choose a file to scan the barcodes on them.">
    <meta name="keywords" content="read barcode from still images">
    <title>Dynamsoft Barcode Reader Sample - Read an Image</title>
</head>

<body>
    <div style="width:80vw;margin:0 auto;">
        <h1 style="font-size: 1.5em;">Read Barcode from Images</h1>
        <input id="ipt-file" type="file" accept="image/png,image/jpeg,image/bmp,image/gif">
        <input id="ipt-readonly-last-result" title="Double click to clear!" readonly placeholder="The Last Read Barcode" style="width:80vw;margin-top:20px;">
        <p id='p-loading' style='font-size:1.5em'>Loading Library...</p>
        <p id='p-reading' style='font-size:1.5em;display:none;'>Reading Barcodes...</p>
        <div id="div-cvs-container" style="width:80vw;height:40vh;margin-top:20px;display:flex;justify-content:center;"></div>
        <p>All Results:</p>
        <div id="div-results" style="width:80vw;height:15vh;padding:16px;overflow-y:auto;border: 1px dashed grey;"></div>
    </div>
    <style>
        .sp-resultText { color: #cE5E04 }
        #div-cvs-container canvas { border: solid 1px gray; }
    </style>
    <!-- <script src="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@8.8.7/dist/dbr.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/keillion-dynamsoft-javascript-barcode@0.20220317102136.0/dist/dbr.js"></script>
    <script>
        /** LICENSE ALERT - README
         *
         * The library requires a license to work.
         * If the license is not specified, a free public trial license will be used by default which is the case in this sample.
         * Note that network connection is required for the public license to work.
         * For more info, please check https://www.dynamsoft.com/barcode-reader/programming/javascript/user-guide/?ver=8.8.7&utm_source=github#specify-the-license or contact support@dynamsoft.com.
         */

        /* When using your own license, uncomment the following line and specify your license. */

        // Dynamsoft.DBR.BarcodeReader.license = "YOUR-ORGANIZATION-ID or YOUR-HANDSHAKECODE or AN-OFFLINE-LICENSE or ANY-OTHER-TYPE-OF-SUPPORTED-LICENSE-STRING";

        /** LICENSE ALERT - THE END */

        // Load the library on page load to speed things up.
        (async() => {
            try {
                await Dynamsoft.DBR.BarcodeReader.loadWasm();
                document.getElementById('p-loading').style.display = 'none';
            } catch (ex) {
                alert(ex.message);
                throw ex;
            }
        })();




        // html elements
        const iptFile = document.getElementById('ipt-file');
        const iptReadonlyLastResult = document.getElementById('ipt-readonly-last-result');
        const pReading = document.getElementById('p-reading');
        const divResults = document.getElementById('div-results');
        const divCvsContainer = document.getElementById('div-cvs-container');


        // reader for decoding pictures
        let pReader = null;
        iptFile.addEventListener('change', async function() {
            const file = this.files[0];
            pReading.style.display = '';
            try {
                const reader = await (pReader = pReader || Dynamsoft.DBR.BarcodeReader.createInstance());
                reader.ifSaveOriginalImageInACanvas = true;
                const results = await reader.decode(file);

                // show image
                divCvsContainer.innerHTML = '';
                divCvsContainer.appendChild(reader.getOriginalImageInACanvas());
                
                // show results
                divResults.appendChild(createEl('h3', file.name + ": "));
                if (0 === results.length) {
                    divResults.appendChild(createEl('p', "No Barcode Found!"));
                }
                for (let result of results) {
                    iptReadonlyLastResult.value = result.barcodeFormatString + ": " + result.barcodeText; // show last txt result
                    const p = document.createElement('p');
                    p.appendChild(createEl('span', result.barcodeFormatString + ": "));
                    p.appendChild(createEl('span', result.barcodeText, "sp-resultText"));
                    divResults.appendChild(p);
                    if (result.barcodeText.indexOf("Attention(exceptionCode") != -1) {
                        divResults.appendChild(createEl('p', "Error: " + result.exception.message));
                    }
                }

                divResults.appendChild(document.createElement('hr'));
                divResults.scrollTop = divResults.scrollHeight;
            } catch (ex) {
                alert(ex.message);
                throw ex;
            } finally {
                pReading.style.display = 'none';
                this.value = '';
            }
        });

        iptReadonlyLastResult.addEventListener('dblclick', async() => {
            iptReadonlyLastResult.value = "";
        });

        function createEl(type, txt, className) {
            const el = document.createElement(type);
            el.textContent = txt;
            if (className){
                el.className = className;
            }
            return el;
        }
    </script>
</body>

</html>